<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLOTHY</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Google Fonts - Kanit -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #20B2AA;
            /* Light Sea Green / Turquoise */
            --secondary-color: #E0F2F1;
            /* Light Turquoise */
            --text-color: #333;
            --kanit-font: 'Kanit', sans-serif;
            --card-bg-color: #FFFFFF;
        }

        body {
            font-family: var(--kanit-font);
            background-color: var(--secondary-color);
            color: var(--text-color);
        }

        .navbar-custom {
            background-color: var(--primary-color);
        }

        .navbar-custom .navbar-brand,
        .navbar-custom .nav-link {
            color: var(--secondary-color);
        }

        .btn-custom {
            background-color: var(--primary-color);
            color: #FFFFFF;
            border: none;
        }

        .btn-custom:hover {
            background-color: #25C5B5;
            /* Lighter Turquoise */
            color: #FFFFFF;
        }
        
        .history-card {
            background-color: var(--card-bg-color);
            border: 1px solid #dee2e6;
            border-radius: 0.75rem;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }

        .history-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        
        .main-choice-card {
            background-color: var(--card-bg-color);
            border-radius: 0.75rem;
            padding: 1.5rem;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            cursor: pointer;
             border: 1px solid #dee2e6;
        }

        .main-choice-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            color: var(--primary-color);
        }
        
        .enhancement-btn {
            border-radius: 50px;
            font-weight: 500;
            transition: all 0.2s ease-in-out;
        }
        
        .enhancement-btn:hover {
           transform: translateY(-3px);
           box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        /* Loading spinner */
        #loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: var(--secondary-color);
            z-index: 9999;
            transition: opacity 0.5s ease-out;
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-custom shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="#">CLOTHY</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="logout-btn">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container my-5">

        <!-- Loading Spinner -->
        <div id="loader">
            <img src="https://img2.pic.in.th/pic/D9CB74F4-0579-4614-BAE6-1E88939CB769.png" alt="Clothy Logo" style="max-height: 150px; margin-bottom: 1rem;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3 text-muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì...</p>
        </div>

        <!-- App Section (Hidden until authenticated and profile is set) -->
        <div id="app-section" class="d-none">
            
            <!-- Main Menu View -->
            <div id="main-menu-view">
                <div class="text-center mb-5">
                     <img src="https://img2.pic.in.th/pic/D9CB74F4-0579-4614-BAE6-1E88939CB769.png" 
                        alt="Clothy Logo" class="img-fluid rounded-3 mb-4" style="max-height: 250px;" loading="lazy" decoding="async">
                    <h1 class="display-5 fw-bold">CLOTHY</h1>
                    <p class="lead" id="welcome-message">MAKE YOUR LUCK!</p>
                </div>
                
                <div class="row g-4 justify-content-center mb-5 text-center">
                     <div class="col-md-5">
                        <div class="main-choice-card" data-option="occasion">
                            <h4 class="fw-bold">‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡∏ß</h4>
                            <p class="text-muted">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ï‡πà‡∏≤‡∏á‡πÜ</p>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="main-choice-card" data-option="personal-color">
                            <h4 class="fw-bold">‡∏ú‡∏¥‡∏ß‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πà ‡∏Å‡∏±‡∏ö‡πÇ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö</h4>
                            <p class="text-muted" id="personal-color-desc">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Personal Color ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                        </div>
                    </div>
                     <div class="col-md-5">
                        <div class="main-choice-card" data-option="style">
                            <h4 class="fw-bold">‡πÄ‡∏´‡∏°‡∏µ‡∏¢‡∏ß‡πÑ‡∏´‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏∏‡∏ì?</h4>
                            <p class="text-muted">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏Ñ‡∏∏‡∏ì</p>
                        </div>
                    </div>
                     <div class="col-md-5">
                        <div class="main-choice-card" data-option="quote">
                            <h4 class="fw-bold">‡∏Ñ‡∏≥‡∏Ñ‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</h4>
                            <p class="text-muted">‚Äú‡∏ñ‡∏∂‡∏á‡∏ô‡∏¥‡∏™‡∏±‡∏¢‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏î‡∏µ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡πâ‡∏î‡∏µ‡πÑ‡∏î‡πâ‚Äù</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Daily Color View -->
            <div id="daily-color-view" class="d-none">
                <div class="d-flex align-items-center mb-4">
                    <button class="btn btn-light me-3" id="back-to-menu-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/></svg>
                    </button>
                    <h2 class="mb-0 fw-bold">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ‡∏°‡∏á‡∏Ñ‡∏•</h2>
                </div>
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <div class="card shadow-sm border-0" style="border-radius: 1rem;">
                            <div class="card-body p-4 p-md-5">
                                <div class="mb-3">
                                    <label for="date-picker" class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
                                    <input type="date" id="date-picker" class="form-control">
                                </div>
                                <p class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏î‡∏ß‡∏á:</p>
                                <div class="d-flex flex-wrap justify-content-center gap-2">
                                    <button class="btn btn-outline-primary enhancement-btn" data-enhancement="‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô">üí∞ ‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</button>
                                    <button class="btn btn-outline-success enhancement-btn" data-enhancement="‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô">üëî ‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô</button>
                                    <button class="btn btn-outline-danger enhancement-btn" data-enhancement="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å">‚ù§Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å</button>
                                    <button class="btn btn-outline-info enhancement-btn" data-enhancement="‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û">üí™ ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</button>
                                    <button class="btn btn-outline-warning enhancement-btn" data-enhancement="‡πÇ‡∏ä‡∏Ñ‡∏•‡∏≤‡∏†">‚ú® ‡πÇ‡∏ä‡∏Ñ‡∏•‡∏≤‡∏†</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row justify-content-center mt-5">
                    <div class="col-md-12">
                         <h3 class="mb-4 text-center">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏µ‡∏°‡∏á‡∏Ñ‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
                        <div id="history-cards-container" class="row g-4"></div>
                        <div id="no-data-message" class="text-center text-muted p-4 d-none">
                            <h5>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏µ‡∏°‡∏á‡∏Ñ‡∏•</h5>
                            <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏î‡∏ß‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal fade" id="profileSetupModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="profileSetupModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title" id="profileSetupModalLabel">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</h5></div>
                <div class="modal-body">
                    <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏¢‡∏¥‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô</p>
                    <form id="profile-form">
                        <div class="mb-3">
                            <label for="gender-select" class="form-label">‡πÄ‡∏û‡∏®</label>
                            <select id="gender-select" class="form-select" required><option value="" disabled selected>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏® --</option><option value="male">‡∏ä‡∏≤‡∏¢</option><option value="female">‡∏´‡∏ç‡∏¥‡∏á</option><option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option></select>
                        </div>
                        <div class="mb-3">
                             <label for="dob-input" class="form-label">‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏µ‡πÄ‡∏Å‡∏¥‡∏î</label>
                             <input type="date" id="dob-input" class="form-control" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-primary" id="save-profile-btn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button></div>
            </div>
        </div>
    </div>
    <!-- Other Modals: Message, Confirmation, Quizzes -->
    <div class="modal fade" id="messageModal" tabindex="-1" aria-labelledby="messageModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="messageModalLabel">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body" id="modal-body-text" style="white-space: pre-wrap;"></div><div class="modal-footer"><button type="button" class="btn btn-custom" data-bs-dismiss="modal">‡∏ï‡∏Å‡∏•‡∏á</button></div></div></div></div>
    <div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="confirmationModalLabel">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><p>‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ?</p></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button><button type="button" class="btn btn-danger" id="confirm-delete-btn">‡∏•‡∏ö</button></div></div></div></div>
    <div class="modal fade" id="personalColorModal" tabindex="-1" aria-labelledby="personalColorModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="personalColorModalLabel">Personal Color ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠?</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><div id="quiz-step-1"><p class="fw-bold">1/3: ‡∏•‡∏≠‡∏á‡∏î‡∏π‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏°‡∏µ‡∏™‡∏µ‡πÇ‡∏ó‡∏ô‡πÑ‡∏´‡∏ô‡πÄ‡∏î‡πà‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏Å‡∏±‡∏ô?</p><div class="d-grid gap-2"><button class="btn btn-outline-success personal-color-quiz-btn" data-value="warm">‡πÇ‡∏ó‡∏ô‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß</button><button class="btn btn-outline-primary personal-color-quiz-btn" data-value="cool">‡πÇ‡∏ó‡∏ô‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô/‡∏°‡πà‡∏ß‡∏á</button><button class="btn btn-outline-secondary personal-color-quiz-btn" data-value="neutral">‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à/‡∏°‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏™‡∏µ</button></div></div><div id="quiz-step-2" class="d-none"><p class="fw-bold">2/3: ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏î‡∏ô‡πÅ‡∏î‡∏î ‡∏ú‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?</p><div class="d-grid gap-2"><button class="btn btn-outline-warning personal-color-quiz-btn" data-value="warm">‡∏ú‡∏¥‡∏ß‡∏Ñ‡∏•‡πâ‡∏≥‡∏Ç‡∏∂‡πâ‡∏ô/‡πÅ‡∏ó‡∏ô‡∏á‡πà‡∏≤‡∏¢</button><button class="btn btn-outline-danger personal-color-quiz-btn" data-value="cool">‡∏ú‡∏¥‡∏ß‡πÅ‡∏î‡∏á/‡πÑ‡∏´‡∏°‡πâ‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏Ñ‡∏•‡πâ‡∏≥</button></div></div><div id="quiz-step-3" class="d-none"><p class="fw-bold">3/3: ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏µ‡πÑ‡∏´‡∏ô‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤?</p><div class="d-grid gap-2"><button class="btn btn-outline-warning personal-color-quiz-btn" data-value="warm">‡∏™‡∏µ‡∏ó‡∏≠‡∏á (Gold)</button><button class="btn btn-outline-info personal-color-quiz-btn" data-value="cool">‡∏™‡∏µ‡πÄ‡∏á‡∏¥‡∏ô (Silver)</button></div></div></div></div></div></div>
    <div class="modal fade" id="styleQuizModal" tabindex="-1" aria-labelledby="styleQuizModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="styleQuizModalLabel">‡πÄ‡∏´‡∏°‡∏µ‡∏¢‡∏ß‡πÑ‡∏´‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏∏‡∏ì?</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><div id="style-quiz-step-1"><p class="fw-bold">1/3: ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î 1 ‡∏ß‡∏±‡∏ô ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏≤‡∏Å‡∏à‡∏∞‡πÑ‡∏õ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£?</p><div class="d-grid gap-2"><button class="btn btn-outline-dark style-quiz-answer-btn" data-value="minimal">‡πÑ‡∏õ‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡πÜ ‡∏≠‡πà‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</button><button class="btn btn-outline-dark style-quiz-answer-btn" data-value="adventure">‡πÑ‡∏õ‡πÄ‡∏î‡∏¥‡∏ô‡∏õ‡πà‡∏≤ ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏Ñ‡∏°‡∏õ‡πå</button><button class="btn btn-outline-dark style-quiz-answer-btn" data-value="fashionista">‡πÑ‡∏õ‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á ‡∏î‡∏π‡∏á‡∏≤‡∏ô‡∏®‡∏¥‡∏•‡∏õ‡∏∞</button></div></div><div id="style-quiz-step-2" class="d-none"><p class="fw-bold">2/3: ‡∏ï‡∏π‡πâ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏≠‡∏∞‡πÑ‡∏£?</p><div class="d-grid gap-2"><button class="btn btn-outline-dark style-quiz-answer-btn" data-value="minimal">‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡πÜ ‡∏Ç‡∏≤‡∏ß ‡∏î‡∏≥ ‡πÄ‡∏ó‡∏≤ ‡∏Ñ‡∏£‡∏µ‡∏°</button><button class="btn btn-outline-dark style-quiz-answer-btn" data-value="adventure">‡∏™‡∏µ‡πÄ‡∏≠‡∏¥‡∏£‡πå‡∏ò‡πÇ‡∏ó‡∏ô ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•</button><button class="btn btn-outline-dark style-quiz-answer-btn" data-value="fashionista">‡∏™‡∏µ‡∏™‡∏±‡∏ô‡∏™‡∏î‡πÉ‡∏™ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏•</button></div></div><div id="style-quiz-step-3" class="d-none"><p class="fw-bold">3/3: ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÑ‡∏î‡πâ 1 ‡∏ä‡∏¥‡πâ‡∏ô ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∞‡πÑ‡∏£?</p><div class="d-grid gap-2"><button class="btn btn-outline-dark style-quiz-answer-btn" data-value="minimal">‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏∑‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡πÜ</button><button class="btn btn-outline-dark style-quiz-answer-btn" data-value="adventure">‡∏´‡∏°‡∏ß‡∏Å‡πÅ‡∏Å‡πä‡∏õ ‡∏´‡∏£‡∏∑‡∏≠ ‡πÄ‡∏õ‡πâ‡πÄ‡∏ó‡πà‡πÜ</button><button class="btn btn-outline-dark style-quiz-answer-btn" data-value="fashionista">‡∏™‡∏£‡πâ‡∏≠‡∏¢‡∏Ñ‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏π‡πÇ‡∏î‡∏î‡πÄ‡∏î‡πà‡∏ô</button></div></div></div></div></div></div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signOut, onAuthStateChanged, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc, query, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- UI Elements ---
        const loader = document.getElementById('loader');
        const appSection = document.getElementById('app-section');
        const logoutBtn = document.getElementById('logout-btn');
        const datePicker = document.getElementById('date-picker');
        const mainMenu = document.getElementById('main-menu-view');
        const dailyColorView = document.getElementById('daily-color-view');
        const backToMenuBtn = document.getElementById('back-to-menu-btn');
        const historyCardsContainer = document.getElementById('history-cards-container');
        const noDataMessage = document.getElementById('no-data-message');
        const personalColorDesc = document.getElementById('personal-color-desc');

        // --- Modals ---
        const messageModal = new bootstrap.Modal(document.getElementById('messageModal'));
        const modalBodyText = document.getElementById('modal-body-text');
        const confirmationModal = new bootstrap.Modal(document.getElementById('confirmationModal'));
        const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
        const profileSetupModal = new bootstrap.Modal(document.getElementById('profileSetupModal'));
        const personalColorModal = new bootstrap.Modal(document.getElementById('personalColorModal'));
        const styleQuizModal = new bootstrap.Modal(document.getElementById('styleQuizModal'));
        
        // --- Quiz State ---
        let personalColorScores, currentPersonalColorQuizStep;
        let styleScores, currentStyleQuizStep;

        const appData = {
            enhancementColors: {"‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô": [{ main: "‡∏™‡∏µ‡∏ó‡∏≠‡∏á", secondary: "‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á" }, { main: "‡∏™‡∏µ‡πÄ‡∏á‡∏¥‡∏ô", secondary: "‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß" }],"‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô": [{ main: "‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô", secondary: "‡∏™‡∏µ‡∏ü‡πâ‡∏≤" }, { main: "‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•", secondary: "‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß" }],"‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å": [{ main: "‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π", secondary: "‡∏™‡∏µ‡πÅ‡∏î‡∏á" }, { main: "‡∏™‡∏µ‡∏û‡∏µ‡∏ä", secondary: "‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß" }],"‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û": [{ main: "‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß", secondary: "‡∏™‡∏µ‡∏Ñ‡∏£‡∏µ‡∏°" }, { main: "‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏≠‡πà‡∏≠‡∏ô", secondary: "‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß" }],"‡πÇ‡∏ä‡∏Ñ‡∏•‡∏≤‡∏†": [{ main: "‡∏™‡∏µ‡∏™‡πâ‡∏°", secondary: "‡∏™‡∏µ‡∏ó‡∏≠‡∏á" }, { main: "‡∏™‡∏µ‡πÅ‡∏î‡∏á", secondary: "‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á" }]},
            quotes: ["‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡∏ß‡∏Ñ‡∏∑‡∏≠‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏π‡∏î‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏•‡∏¢","‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ã‡∏∑‡πâ‡∏≠ ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Ñ‡∏∑‡∏≠‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á","‡∏à‡∏á‡∏™‡∏á‡πà‡∏≤‡∏á‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á","‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Ñ‡∏∑‡∏≠‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"],
            personalColor: { warm: "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ Warm Tone (Spring/Autumn)!\n\n‡∏™‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡∏™‡∏µ‡πÇ‡∏ó‡∏ô‡∏≠‡∏∏‡πà‡∏ô ‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡πâ‡∏°, ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á, ‡∏ó‡∏≠‡∏á, ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏°‡∏∞‡∏Å‡∏≠‡∏Å, ‡πÅ‡∏î‡∏á‡∏≠‡∏¥‡∏ê", cool: "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ Cool Tone (Summer/Winter)!\n\n‡∏™‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡∏™‡∏µ‡πÇ‡∏ó‡∏ô‡πÄ‡∏¢‡πá‡∏ô ‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô, ‡∏ü‡πâ‡∏≤, ‡∏°‡πà‡∏ß‡∏á, ‡∏ä‡∏°‡∏û‡∏π, ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏≠‡∏°‡∏ü‡πâ‡∏≤", neutral: "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ Neutral Tone!\n\n‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏™‡πà‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏™‡∏µ‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏ó‡∏ô‡∏£‡πâ‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡πÇ‡∏ó‡∏ô‡πÄ‡∏¢‡πá‡∏ô" },
            styles: { minimal: "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ '‡πÄ‡∏´‡∏°‡∏µ‡∏¢‡∏ß‡∏°‡∏¥‡∏ô‡∏¥‡∏°‡∏≠‡∏•'!\n‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏á‡πà‡∏≤‡∏¢ ‡πÅ‡∏ï‡πà‡∏î‡∏π‡∏î‡∏µ ‡πÄ‡∏ô‡πâ‡∏ô‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡πÜ ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡∏≤‡∏ß ‡∏î‡∏≥ ‡πÄ‡∏ó‡∏≤ ‡∏Ñ‡∏£‡∏µ‡∏° ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏±‡∏ï‡∏ï‡∏¥‡πâ‡∏á‡πÄ‡∏ô‡∏µ‡πâ‡∏¢‡∏ö", adventure: "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ '‡πÄ‡∏´‡∏°‡∏µ‡∏¢‡∏ß‡∏™‡∏≤‡∏¢‡∏•‡∏∏‡∏¢'!\n‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ö‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤‡πÅ‡∏ô‡∏ß‡πÄ‡∏≠‡∏¥‡∏£‡πå‡∏ò‡πÇ‡∏ó‡∏ô ‡∏Å‡∏≤‡∏á‡πÄ‡∏Å‡∏á‡∏Ñ‡∏≤‡∏£‡πå‡πÇ‡∏Å‡πâ ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡∏ö‡∏π‡∏ó", fashionista: "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ '‡πÄ‡∏´‡∏°‡∏µ‡∏¢‡∏ß‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô‡∏ô‡∏¥‡∏™‡∏ï‡πâ‡∏≤'!\n‡∏Ñ‡∏∏‡∏ì‡∏™‡∏ô‡∏∏‡∏Å‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏Å‡∏•‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏≠‡∏á‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡∏°‡πà‡πÜ ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏ï‡πá‡∏°‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏µ‡∏™‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÉ‡∏Ñ‡∏£" }
        };

        const showMessage = (message, title = "‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô") => {
            document.getElementById('messageModalLabel').innerText = title;
            modalBodyText.innerText = message;
            messageModal.show();
        };
        
        const renderHistoryCards = (data) => {
            historyCardsContainer.innerHTML = '';
            if (data && data.length > 0) {
                noDataMessage.classList.add('d-none');
                data.forEach(item => {
                    const cardCol = document.createElement('div');
                    cardCol.className = 'col-md-6 col-lg-4';
                    cardCol.innerHTML = `<div class="card history-card h-100"><div class="card-body"><h5 class="card-title fw-bold">${item.enhancement_type}</h5><h6 class="card-subtitle mb-2 text-muted">${item.selected_date}</h6><p class="card-text mb-1"><strong>‡∏™‡∏µ‡∏´‡∏•‡∏±‡∏Å:</strong> ${item.main_color}</p><p class="card-text"><strong>‡∏™‡∏µ‡∏£‡∏≠‡∏á:</strong> ${item.secondary_color}</p><button class="btn btn-sm btn-outline-danger delete-btn" data-id="${item.id}">‡∏•‡∏ö</button></div></div>`;
                    historyCardsContainer.appendChild(cardCol);
                });
                document.querySelectorAll('.delete-btn').forEach(button => { button.addEventListener('click', (e) => { confirmDeleteBtn.dataset.docId = e.target.dataset.id; confirmationModal.show(); }); });
            } else {
                noDataMessage.classList.remove('d-none');
            }
        };

        const updateUIWithProfile = (profileData) => {
            if (profileData?.personal_color) {
                const toneText = profileData.personal_color.charAt(0).toUpperCase() + profileData.personal_color.slice(1);
                personalColorDesc.innerHTML = `‡∏ú‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: <strong>${toneText} Tone</strong><br><small>(‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á)</small>`;
            } else {
                 personalColorDesc.innerText = "‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Personal Color ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì";
            }
        };

        const resetPersonalColorQuiz = () => {
            personalColorScores = { warm: 0, cool: 0, neutral: 0 };
            currentPersonalColorQuizStep = 1;
            document.getElementById('quiz-step-1').classList.remove('d-none');
            document.getElementById('quiz-step-2').classList.add('d-none');
            document.getElementById('quiz-step-3').classList.add('d-none');
        };
        
        const resetStyleQuiz = () => {
            styleScores = { minimal: 0, adventure: 0, fashionista: 0 };
            currentStyleQuizStep = 1;
            document.getElementById('style-quiz-step-1').classList.remove('d-none');
            document.getElementById('style-quiz-step-2').classList.add('d-none');
            document.getElementById('style-quiz-step-3').classList.add('d-none');
        };

        async function main() {
            const today = new Date();
            datePicker.value = today.toISOString().split('T')[0];

            const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
            if (!firebaseConfig.apiKey) { loader.innerHTML = "Firebase configuration is missing."; return; }

            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) { await signInWithCustomToken(auth, __initial_auth_token); } else { await signInAnonymously(auth); }
            } catch (error) { console.error("Authentication Error:", error); loader.innerHTML = "Authentication failed."; return; }

            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    const userId = user.uid;
                    const profileDocRef = doc(db, 'artifacts', appId, 'users', userId, 'profile', 'user_info');
                    const colorsCollectionRef = collection(db, 'artifacts', appId, 'users', userId, 'lucky_colors');

                    const profileSnap = await getDoc(profileDocRef);
                    if (!profileSnap.exists() || !profileSnap.data().gender || !profileSnap.data().dob) {
                        loader.style.opacity = '0';
                        setTimeout(() => loader.classList.add('d-none'), 500);
                        profileSetupModal.show();
                    } else {
                        document.getElementById('welcome-message').innerText = `‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö, ‡∏Ñ‡∏∏‡∏ì ${profileSnap.data().gender === 'male' ? '‡∏ä‡∏≤‡∏¢' : '‡∏´‡∏ç‡∏¥‡∏á'}!`;
                        loader.style.opacity = '0';
                        setTimeout(() => {
                            loader.classList.add('d-none');
                            appSection.classList.remove('d-none');
                        }, 500);
                    }

                    document.getElementById('save-profile-btn').addEventListener('click', async () => {
                        const gender = document.getElementById('gender-select').value;
                        const dob = document.getElementById('dob-input').value;
                        if (gender && dob) {
                            try {
                                await setDoc(profileDocRef, { gender, dob }, { merge: true });
                                profileSetupModal.hide();
                                loader.style.opacity = '0';
                                setTimeout(() => {
                                    loader.classList.add('d-none');
                                    appSection.classList.remove('d-none');
                                }, 500);
                                document.getElementById('welcome-message').innerText = `‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö, ‡∏Ñ‡∏∏‡∏ì ${gender === 'male' ? '‡∏ä‡∏≤‡∏¢' : '‡∏´‡∏ç‡∏¥‡∏á'}!`;
                            } catch (error) { showMessage("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: " + error.message); }
                        } else { showMessage("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô"); }
                    });

                    onSnapshot(query(colorsCollectionRef), (snapshot) => {
                        const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        data.sort((a, b) => b.timestamp - a.timestamp);
                        renderHistoryCards(data);
                    });
                    
                    onSnapshot(profileDocRef, (doc) => { updateUIWithProfile(doc.data()); });

                    document.querySelectorAll('.main-choice-card').forEach(card => {
                        card.addEventListener('click', () => {
                            const option = card.dataset.option;
                            if(option === 'occasion'){ mainMenu.classList.add('d-none'); dailyColorView.classList.remove('d-none'); }
                            if(option === 'personal-color'){ resetPersonalColorQuiz(); personalColorModal.show(); }
                            if(option === 'style'){ resetStyleQuiz(); styleQuizModal.show(); }
                            if(option === 'quote'){ const quote = appData.quotes[Math.floor(Math.random() * appData.quotes.length)]; showMessage(quote, "‡∏Ñ‡∏≥‡∏Ñ‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô"); }
                        });
                    });
                    
                    backToMenuBtn.addEventListener('click', () => { dailyColorView.classList.add('d-none'); mainMenu.classList.remove('d-none'); });

                    document.querySelectorAll('.enhancement-btn').forEach(button => {
                        button.addEventListener('click', async (e) => {
                            const type = e.target.dataset.enhancement;
                            const date = new Date(datePicker.value).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' });
                            const colors = appData.enhancementColors[type][Math.floor(Math.random() * appData.enhancementColors[type].length)];
                            const newData = { selected_date: date, enhancement_type: type, main_color: colors.main, secondary_color: colors.secondary, timestamp: Date.now() };
                            try { await addDoc(colorsCollectionRef, newData); showMessage(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏µ‡∏°‡∏á‡∏Ñ‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö '${type}' ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${date} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!`); } catch (error) { showMessage("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: " + error.message); }
                        });
                    });

                    document.querySelectorAll('.personal-color-quiz-btn').forEach(button => {
                        button.addEventListener('click', async (e) => {
                            personalColorScores[e.target.dataset.value]++;
                            document.getElementById(`quiz-step-${currentPersonalColorQuizStep}`).classList.add('d-none');
                            currentPersonalColorQuizStep++;
                            if (currentPersonalColorQuizStep > 3) {
                                personalColorModal.hide();
                                let result = 'neutral';
                                if (personalColorScores.warm > personalColorScores.cool) result = 'warm';
                                if (personalColorScores.cool > personalColorScores.warm) result = 'cool';
                                try { await setDoc(profileDocRef, { personal_color: result }, { merge: true }); showMessage(appData.personalColor[result], '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! Personal Color ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠'); } catch (error) { showMessage("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: " + error.message); }
                            } else { document.getElementById(`quiz-step-${currentPersonalColorQuizStep}`).classList.remove('d-none'); }
                        });
                    });
                     document.querySelectorAll('.style-quiz-answer-btn').forEach(button => {
                        button.addEventListener('click', e => {
                            styleScores[e.target.dataset.value]++;
                            document.getElementById(`style-quiz-step-${currentStyleQuizStep}`).classList.add('d-none');
                            currentStyleQuizStep++;
                            if (currentStyleQuizStep > 3) {
                                styleQuizModal.hide();
                                let result = 'minimal';
                                if (styleScores.adventure > styleScores.minimal && styleScores.adventure > styleScores.fashionista) result = 'adventure';
                                if (styleScores.fashionista > styleScores.minimal && styleScores.fashionista > styleScores.adventure) result = 'fashionista';
                                showMessage(appData.styles[result], "‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠...");
                            } else { document.getElementById(`style-quiz-step-${currentStyleQuizStep}`).classList.remove('d-none'); }
                        });
                    });

                    confirmDeleteBtn.addEventListener('click', async (e) => {
                        const docId = e.target.dataset.docId;
                         if (docId) {
                            const docRef = doc(db, 'artifacts', appId, 'users', userId, 'lucky_colors', docId);
                            try { await deleteDoc(docRef); confirmationModal.hide(); showMessage("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!"); } catch (error) { showMessage("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: " + error.message); }
                        }
                    });
                } else {
                    loader.classList.remove('d-none');
                    loader.innerHTML = "You have been logged out. Please refresh.";
                    appSection.classList.add('d-none');
                }
            });

            logoutBtn.addEventListener('click', () => { signOut(auth).catch(error => showMessage("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö: " + error.message)); });
        }
        main();
    </script>
</body>
</html>

